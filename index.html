<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Start Vitals</title>
<link rel="manifest" href="manifest.json?v=3">
<meta name="theme-color" content="#3498db">
<script>
  // Force update of service worker (to ensure newest version loads)
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', async () => {
      const reg = await navigator.serviceWorker.register('sw.js?v=' + Date.now());
      if (reg.waiting) reg.waiting.postMessage({ type: 'SKIP_WAITING' });
    });
  }
  if (navigator.serviceWorker) {
    navigator.serviceWorker.addEventListener('controllerchange', () => {
      window.location.reload();
    });
  }
</script>
<style>
:root {
    --primary-bg: #f4f7f9;
    --secondary-bg: rgba(255,255,255,0.95);
    --border-color: #dbe2e8;
    --text-color: #2c3e50;
    --primary-accent: #3498db;
    --secondary-accent: #2ecc71;
    --danger-accent: #e74c3c;
    --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}
body {
    font-family: var(--font-family);
    background-color: var(--primary-bg);
    background-image: url('icon-512.png');
    background-repeat: no-repeat;
    background-position: center;
    background-size: 150px 150px;
    color: var(--text-color);
    margin: 0;
    padding: 10px;
    font-size: 16px;
}
.container {
    max-width: 800px;
    margin: 0 auto;
    background-color: var(--secondary-bg);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    overflow: hidden;
}
.tab-nav {
    display: flex;
    background-color: #ecf0f1;
    border-bottom: 1px solid var(--border-color);
    overflow-x: auto;
}
.tab-button {
    padding: 15px 20px;
    border: none;
    background-color: transparent;
    cursor: pointer;
    font-size: 1em;
    font-weight: 500;
    color: var(--text-color);
    transition: background-color 0.3s, color 0.3s;
    white-space: nowrap;
}
.tab-button.active {
    background-color: var(--primary-accent);
    color: white;
    border-bottom: 3px solid var(--secondary-accent);
}
.tab-content {
    display: none;
    padding: 20px;
    animation: fadeIn 0.5s;
}
.tab-content.active {
    display: block;
}
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
.form-group {
    margin-bottom: 20px;
}
.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
}
.form-group input, .form-group textarea, .form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    box-sizing: border-box;
    font-size: 1em;
}
.form-group textarea {
    min-height: 100px;
    resize: vertical;
}
.input-group {
    display: flex;
    gap: 10px;
    align-items: center;
}
.input-group input[type="number"] {
    flex: 1;
}
.input-group-addon {
    background-color: #ecf0f1;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    white-space: nowrap;
}
.gcs-section {
    margin-bottom: 20px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    padding: 15px;
}
.gcs-section h3 {
    margin-top: 0;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 10px;
    font-size: 1.1em;
}
.gcs-option {
    display: block;
    margin-bottom: 10px;
}
#gcs-total {
    font-size: 1.5em;
    font-weight: bold;
    text-align: center;
    padding: 15px;
    background-color: var(--primary-accent);
    color: white;
    border-radius: 5px;
    margin-top: 20px;
}
.btn {
    padding: 12px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
    font-weight: bold;
    transition: background-color 0.3s;
}
.btn-primary {
    background-color: var(--secondary-accent);
    color: white;
}
.btn-primary:hover {
    background-color: #27ae60;
}
.btn-secondary {
    background-color: #bdc3c7;
    color: var(--text-color);
}
.btn-secondary:hover {
    background-color: #95a5a6;
}
.alert {
    margin-top: 10px;
    padding: 10px;
    border-radius: 5px;
    font-weight: bold;
    display: none;
}
.alert.warning { background-color: #f1c40f; color: #000; }
.alert.danger { background-color: #e74c3c; color: #fff; }
#results-output {
    white-space: pre-wrap;
    background-color: #ecf0f1;
    border: 1px solid var(--border-color);
    padding: 15px;
    border-radius: 5px;
    min-height: 200px;
    font-family: "Courier New", Courier, monospace;
}
</style>
</head>
<body>

<div class="container">
<div class="tab-nav">
    <button class="tab-button active" onclick="openTab(event, 'patient-info')">Patient Info</button>
    <button class="tab-button" onclick="openTab(event, 'vitals')">Vitals</button>
    <button class="tab-button" onclick="openTab(event, 'gcs')">GCS</button>
    <button class="tab-button" onclick="openTab(event, 'notes')">Notes</button>
    <button class="tab-button" onclick="openTab(event, 'results')">Results</button>
</div>

<!-- Patient Info -->
<div id="patient-info" class="tab-content active">
    <h2>Patient Information</h2>
    <div class="form-group">
        <label for="responder-id">Responder ID</label>
        <input type="text" id="responder-id" placeholder="e.g., ST186">
    </div>
    <div class="form-group">
        <label for="incident-type">Incident Type</label>
        <input type="text" id="incident-type" placeholder="e.g., MVA, Fall, Cardiac Event">
    </div>
    <div class="form-group">
        <label for="patient-name">Name</label>
        <input type="text" id="patient-name" placeholder="e.g., John Doe">
    </div>
    <div class="form-group">
        <label for="patient-age">Age</label>
        <input type="number" id="patient-age" placeholder="e.g., 35">
    </div>
    <div class="form-group">
        <label for="allergies">Allergies</label>
        <input type="text" id="allergies" placeholder="e.g., Penicillin">
    </div>
    <div class="form-group">
        <label for="medication">Medication</label>
        <input type="text" id="medication" placeholder="e.g., Lisinopril">
    </div>
    <div class="form-group">
        <label for="history">Past History</label>
        <input type="text" id="history" placeholder="e.g., Hypertension">
    </div>
    <div class="form-group">
        <label for="last-intake">Last Intake (Food/Drink)</label>
        <input type="text" id="last-intake" placeholder="e.g., Water at 10:00 AM">
    </div>
</div>

<!-- Vitals -->
<div id="vitals" class="tab-content">
    <h2>Vitals</h2>
    <div class="form-group">
        <label for="bp">Blood Pressure (mmHg)</label>
        <div class="input-group">
            <input type="number" id="bp-sys" placeholder="Systolic">
            <span>/</span>
            <input type="number" id="bp-dia" placeholder="Diastolic">
        </div>
    </div>
    <div class="form-group">
        <label for="pulse">Pulse</label>
        <div class="input-group">
            <input type="number" id="pulse" placeholder="e.g., 80">
            <span class="input-group-addon">bpm</span>
        </div>
    </div>
    <div class="form-group">
        <label for="spo2">SPO₂</label>
        <div class="input-group">
            <input type="number" id="spo2" placeholder="e.g., 98">
            <span class="input-group-addon">%</span>
            <select id="o2-source" style="flex: 0.8;">
                <option value="Room Air">Room Air</option>
                <option value="On O₂">On O₂</option>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label for="rrate">Respiratory Rate</label>
        <div class="input-group">
            <input type="number" id="rrate" placeholder="e.g., 16">
            <span class="input-group-addon">/min</span>
        </div>
    </div>
    <div class="form-group">
        <label for="temp">Temperature</label>
        <div class="input-group">
            <input type="number" id="temp" placeholder="e.g., 36.8" step="0.1">
            <span class="input-group-addon">°C</span>
        </div>
    </div>
    <div class="form-group">
        <label for="cap-refill">Capillary Refill</label>
        <div class="input-group">
            <input type="number" id="cap-refill" placeholder="e.g., 2">
            <span class="input-group-addon">s</span>
        </div>
    </div>
    <div class="form-group">
        <label for="pupils">Pupils</label>
        <div class="input-group">
            <input type="number" id="pupils-left" placeholder="Left (mm)">
            <input type="number" id="pupils-right" placeholder="Right (mm)">
        </div>
    </div>
    <div class="form-group">
        <label for="pain">Pain Score</label>
        <div class="input-group">
            <input type="number" id="pain" placeholder="e.g., 5" min="0" max="10">
            <span class="input-group-addon">/10</span>
        </div>
    </div>
    <button class="btn btn-primary" onclick="submitVitals()">Submit Vitals</button>
    <div id="vital-alert" class="alert"></div>
</div>

<!-- GCS -->
<div id="gcs" class="tab-content">
    <h2>Glasgow Coma Scale (GCS)</h2>
    <div class="gcs-section">
        <h3>Eye Opening</h3>
        <label><input type="radio" name="gcs-eye" value="4"> Spontaneous (4)</label>
        <label><input type="radio" name="gcs-eye" value="3"> To Speech (3)</label>
        <label><input type="radio" name="gcs-eye" value="2"> To Pain (2)</label>
        <label><input type="radio" name="gcs-eye" value="1"> None (1)</label>
    </div>
    <div class="gcs-section">
        <h3>Verbal Response</h3>
        <label><input type="radio" name="gcs-verbal" value="5"> Oriented (5)</label>
        <label><input type="radio" name="gcs-verbal" value="4"> Confused (4)</label>
        <label><input type="radio" name="gcs-verbal" value="3"> Inappropriate (3)</label>
        <label><input type="radio" name="gcs-verbal" value="2"> Incomprehensible (2)</label>
        <label><input type="radio" name="gcs-verbal" value="1"> None (1)</label>
    </div>
    <div class="gcs-section">
        <h3>Motor Response</h3>
        <label><input type="radio" name="gcs-motor" value="6"> Obeys (6)</label>
        <label><input type="radio" name="gcs-motor" value="5"> Localises Pain (5)</label>
        <label><input type="radio" name="gcs-motor" value="4"> Withdraws (4)</label>
        <label><input type="radio" name="gcs-motor" value="3"> Flexion (3)</label>
        <label><input type="radio" name="gcs-motor" value="2"> Extension (2)</label>
        <label><input type="radio" name="gcs-motor" value="1"> None (1)</label>
    </div>
    <div id="gcs-total">Total GCS Score: 0 / 15</div>
    <button class="btn btn-primary" onclick="submitGCS()">Submit GCS</button>
    <div id="gcs-alert" class="alert"></div>
</div>

<!-- Notes -->
<div id="notes" class="tab-content">
    <h2>Signs/Symptoms & Notes</h2>
    <div class="form-group">
        <label>Signs / Symptoms</label>
        <textarea id="signs-symptoms"></textarea>
    </div>
    <div class="form-group">
        <label>Additional Notes</label>
        <textarea id="general-notes"></textarea>
    </div>
</div>

<!-- Results -->
<div id="results" class="tab-content">
    <h2>Consolidated Results</h2>
    <div class="form-group">
        <button class="btn btn-primary" onclick="generateResults()">Generate Handover Report</button>
    </div>
    <div class="form-group">
        <textarea id="results-output" readonly></textarea>
    </div>
    <div class="form-group">
        <button class="btn btn-secondary" onclick="copyResults()">Copy to Clipboard</button>
    </div>
</div>
</div>

<script>
let vitalsLog = [];
let gcsLog = [];

// Tabs
function openTab(evt, tabName) {
    const tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(t => t.style.display = "none");
    document.getElementById(tabName).style.display = "block";
    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
    evt.currentTarget.classList.add('active');
}

// GCS calc
document.querySelectorAll('input[name^="gcs"]').forEach(el => {
    el.addEventListener('change', calculateGCS);
});
function calculateGCS() {
    const e = parseInt(document.querySelector('input[name="gcs-eye"]:checked')?.value || 0);
    const v = parseInt(document.querySelector('input[name="gcs-verbal"]:checked')?.value || 0);
    const m = parseInt(document.querySelector('input[name="gcs-motor"]:checked')?.value || 0);
    const total = e + v + m;
    document.getElementById('gcs-total').innerText = `Total GCS Score: ${total} / 15 (E${e} V${v} M${m})`;
}

// Submit vitals
function submitVitals() {
    const now = new Date().toLocaleTimeString();
    const vitals = {
        time: now,
        bp: `${document.getElementById('bp-sys').value}/${document.getElementById('bp-dia').value}`,
        pulse: document.getElementById('pulse').value,
        spo2: document.getElementById('spo2').value,
        o2source: document.getElementById('o2-source').value,
        rrate: document.getElementById('rrate').value,
        temp: document.getElementById('temp').value,
        caprefill: document.getElementById('cap-refill').value,
        pupils: `${document.getElementById('pupils-left').value}/${document.getElementById('pupils-right').value}`,
        pain: document.getElementById('pain').value
    };
    vitalsLog.push(vitals);
    document.querySelectorAll('#vitals input').forEach(i => i.value = '');
    showAlert('vital-alert', 'Vitals recorded at ' + now, 'warning');
}

// Submit GCS
function submitGCS() {
    const now = new Date().toLocaleTimeString();
    const gcsText = document.getElementById('gcs-total').innerText;
    gcsLog.push({ time: now, gcs: gcsText });
    document.querySelectorAll('input[name^="gcs"]').forEach(i => i.checked = false);
    document.getElementById('gcs-total').innerText = "Total GCS Score: 0 / 15";
    showAlert('gcs-alert', 'GCS recorded at ' + now, 'warning');
}

// Alert display
function showAlert(id, msg, type) {
    const alertBox = document.getElementById(id);
    alertBox.innerText = msg;
    alertBox.className = `alert ${type}`;
    alertBox.style.display = 'block';
    setTimeout(() => { alertBox.style.display = 'none'; }, 2500);
}

// Generate Report
function generateResults() {
    const info = {
        responder: document.getElementById('responder-id').value,
        incident: document.getElementById('incident-type').value,
        name: document.getElementById('patient-name').value,
        age: document.getElementById('patient-age').value,
        allergies: document.getElementById('allergies').value,
        medication: document.getElementById('medication').value,
        history: document.getElementById('history').value,
        intake: document.getElementById('last-intake').value
    };
    let report = `--- PATIENT HANDOVER REPORT ---\n\nResponder ID   : ${info.responder}\nIncident Type  : ${info.incident}\nName           : ${info.name}\nAge            : ${info.age}\nAllergies      : ${info.allergies}\nMedication     : ${info.medication}\nPast History   : ${info.history}\nLast Intake    : ${info.intake}\n\n--- VITALS ---\n`;
    vitalsLog.forEach(v => {
        report += `BP: ${v.bp} mmHg ${v.time}\nPulse: ${v.pulse} bpm ${v.time}\nSPO₂: ${v.spo2}% (${v.o2source}) ${v.time}\nResp Rate: ${v.rrate}/min ${v.time}\nTemp: ${v.temp} °C ${v.time}\nCap Refill: ${v.caprefill}s ${v.time}\nPupils: ${v.pupils} mm ${v.time}\nPain: ${v.pain}/10 ${v.time}\n\n`;
    });
    report += "--- GCS ---\n";
    gcsLog.forEach(g => {
        report += `${g.gcs} ${g.time}\n`;
    });
    report += "\n--- SIGNS / SYMPTOMS ---\n" + document.getElementById('signs-symptoms').value + "\n\n--- ADDITIONAL NOTES ---\n" + document.getElementById('general-notes').value;
    document.getElementById('results-output').value = report;
}

// Copy
function copyResults() {
    const output = document.getElementById('results-output');
    output.select();
    document.execCommand('copy');
    showAlert('gcs-alert', 'Copied to clipboard!', 'warning');
}
</script>

</body>
</html>
